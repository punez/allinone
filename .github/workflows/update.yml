- name: Download subconverter
  run: |
    wget https://github.com/tindy2013/subconverter/releases/latest/download/subconverter_linux64.tar.gz
    tar -xzf subconverter_linux64.tar.gz
    cd subconverter
    chmod +x subconverter

- name: Prepare links
  run: |
    mkdir -p subconverter/output
    LINKS=$(paste -sd "|" sources.txt)
    echo "[custom]" > subconverter/pref.ini
    echo "path=output" >> subconverter/pref.ini
    echo "url=$LINKS" >> subconverter/pref.ini

- name: Convert
  run: |
    cd subconverter
    ./subconverter -g

- name: Move result
  run: |
    mkdir -p output
    cp subconverter/output/* output/sub.txt || true
